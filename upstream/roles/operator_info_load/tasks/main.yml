---
- name: "Load operator info from file"
  block:
    # - name: "Parsing config file '{{ operator_info_file }}'"
    #   include_vars:
    #     file: "{{ operator_info_file }}"
    #     name: op_info
    #     remote_src: true
    #     # name: operator_info_vars
    - name: "Check if '{{ operator_info_file }}' file exists"
      stat:
        path: "{{ operator_info_file }}"
      register: operator_info_file_st

    - name: "Fail when file '{{ operator_info_file }}' doesn't exists"
      fail:
        msg: "Operator info file '{{ operator_info_file }}' doens't exists !!!"
      when: not operator_info_file_st.stat.exists

    - name: "Getting content from '{{ operator_info_file }}'"
      shell: "cat {{ operator_info_file }}"
      register: operator_info_data
      ignore_errors: true

    - name: "Sets operator info variables from '{{ operator_info_file }}'"
      set_fact:
        op_info: "{{ operator_info_data.stdout | from_yaml }}"
      when: operator_info_data.rc == 0

    - name: "Sets operator info variables from '{{ operator_info_file }}'"
      set_fact:
        operator_base_dir: "{{ operator_bundle_src_dir }}"
        operators: "{{ op_info.keys() | list | join(',') }}"
      when:
        - op_info is defined

    - name: "Artifacts consistency check"
      include_tasks: op_info_consistency.yml
      when:
        - skip_operator_info_consistency is undefined or is not skip_operator_info_consistency|bool

  when:
    - operator_info_file is defined
    - operator_info_file| length > 0

- name: "Print final 'op_info'"
  debug:
    var: op_info
