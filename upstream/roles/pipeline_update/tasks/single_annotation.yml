---
- name: "Getting content of '{{ an_item }}' file"
  shell: "cat {{ an_item }}"
  register: annotation_data

- name: "Sets `annotations_vars` from yaml file"
  set_fact:
    annotations_vars: "{{ annotation_data.stdout | from_yaml }}"

- name: "Getting label 'com.redhat.openshift.versions'"
  set_fact:
    op_label: "{{ annotations_vars.annotations['com.redhat.openshift.versions'] | default('')}}"

- name: "Adding operator '{{ an_item.split('/')[-4] }} {{ an_item.split('/')[-3] }}' "
  set_fact:
    pu_recreate_operators_versions: "{{ (pu_recreate_operators_versions | default([])) + [ an_item.split('/')[-4] + ':' + an_item.split('/')[-3] ] }}"
  when:
    - op_label | length > 0
    - op_label is search(pu_index_version_1) or op_label is search(pu_index_version_2)

- name: "Adding operator '{{ an_item.split('/')[-4] }} {{ an_item.split('/')[-3] }}' "
  set_fact:
    pu_recreate_operators: "{{ (pu_recreate_operators | default([])) + [ an_item.split('/')[-4] ] }}"
  when:
    - op_label | length > 0
    - op_label is search(pu_index_version_1) or op_label is search(pu_index_version_2)
